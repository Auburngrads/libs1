<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Estimate subject-specific or standardised survival...</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for posterior_survfit {rstanarm}"><tr><td>posterior_survfit {rstanarm}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Estimate subject-specific or standardised survival probabilities</h2>

<h3>Description</h3>

<p>This function allows us to generate estimated survival probabilities 
based on draws from the posterior predictive distribution. If 
<code>newdataLong</code> and <code>newdataEvent</code> are provided, then the 
group-specific coefficients for the new individuals
will be drawn using a Monte Carlo scheme conditional on the new longitudinal
outcome data (sometimes referred to as &quot;dynamic predictions&quot;, see Rizopoulos
(2011)). In addition, by default the predicted subject-specific survival 
probabilities are conditional on observed values of the fixed effect 
covariates (ie, the predictions will be obtained using either the design 
matrices used in the original <code><a href="stan_jm.html">stan_jm</a></code> model call, or using the 
covariate values provided in the <code>newdataLong</code> and <code>newdataEvent</code> 
arguments). However, if you wish to average over the observed distribution 
of the fixed effect covariates then this is possible &ndash; such predictions
are sometimes referred to as standardised survival probabilties &ndash; see the 
<code>standardise</code> argument below.
</p>


<h3>Usage</h3>

<pre>
posterior_survfit(object, newdataLong = NULL, newdataEvent = NULL,
  extrapolate = TRUE, control = list(), condition = NULL,
  last_time = NULL, prob = 0.95, ids, times = NULL, standardise = FALSE,
  scale = 1.5, draws = NULL, seed = NULL, ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>object</code></td>
<td>
<p>A fitted model object returned by the 
<code><a href="stan_jm.html">stan_jm</a></code> modelling function. See 
<code><a href="stanreg-objects.html">stanreg-objects</a></code>.</p>
</td></tr>
<tr valign="top"><td><code>newdataLong, newdataEvent</code></td>
<td>
<p>Optionally, a data frame (or in the case of 
<code>newdataLong</code> this can be a list of data frames) in which to look 
for variables with which to predict. If omitted, the model matrices are used. 
If new data is provided, then it should also contain the longitudinal 
outcome data on which to condition when drawing the new group-specific 
coefficients for individuals in the new data. Note that there is only
allowed to be one row of data for each individual in <code>newdataEvent</code>, 
that is, time-varying covariates are not allowed in the prediction data for
the event submodel. Also, <code>newdataEvent</code> can optionally include a 
variable with information about the last known survival time for the new
individuals &ndash; see the description for the <code>last_time</code> argument below
&ndash; however also note that when generating the survival probabilities it 
is of course assumed that all individuals in <code>newdataEvent</code> have not 
yet experienced the event (that is, any variable in <code>newdataEvent</code> that
corresponds to the event indicator will be ignored).</p>
</td></tr>
<tr valign="top"><td><code>extrapolate</code></td>
<td>
<p>A logical specifying whether to extrapolate the estimated 
survival probabilities beyond the times specified in the <code>times</code> argument.
If <code>TRUE</code> then the extrapolation can be further controlled using
the <code>control</code> argument.</p>
</td></tr>
<tr valign="top"><td><code>control</code></td>
<td>
<p>A named list with parameters controlling extrapolation 
of the estimated survival function when <code>extrapolate = TRUE</code>. The list
can contain one or more of the following named elements: <br />
</p>

<dl>
<dt><code>epoints</code></dt><dd><p>a positive integer specifying the number of  
discrete time points at which to calculate the forecasted survival 
probabilities. The default is 10.</p>
</dd>
<dt><code>edist</code></dt><dd><p>a positive scalar specifying the amount of time 
across which to forecast the estimated survival function, represented 
in units of the time variable <code>time_var</code> (from fitting the model). 
The default is to extrapolate between the times specified in the 
<code>times</code> argument and the maximum event or censoring time in the 
original data. If <code>edist</code> leads to times that are beyond
the maximum event or censoring time in the original data then the 
estimated survival probabilities will be truncated at that point, since
the estimate for the baseline hazard is not available beyond that time.</p>
</dd>
</dl>
</td></tr>
<tr valign="top"><td><code>condition</code></td>
<td>
<p>A logical specifying whether the estimated 
subject-specific survival probabilities at time <code>t</code> should be 
conditioned on survival up to a fixed time point <code>u</code>. The default 
is for <code>condition</code> to be set to <code>TRUE</code>, unless standardised survival
probabilities have been requested (by specifying <code>standardise = TRUE</code>),
in which case <code>condition</code> must (and will) be set to <code>FALSE</code>.
When conditional survival probabilities are requested, the fixed
time point <code>u</code> will be either: (i) the value specified via the 
<code>last_time</code> argument; or if the <code>last_time</code> argument is 
<code>NULL</code> then the latest observation time for each individual 
(taken to be the value in the <code>times</code> argument if <code>newdataEvent</code> 
is specified, or the observed event or censoring time if <code>newdataEvent</code> 
is <code>NULL</code>.</p>
</td></tr>
<tr valign="top"><td><code>last_time</code></td>
<td>
<p>A scalar, character string, or <code>NULL</code>. This argument 
specifies the last known survival time for each individual when
conditional predictions are being obtained. If 
<code>newdataEvent</code> is provided and conditional survival predictions are being
obtained, then the <code>last_time</code> argument can be one of the following:
(i) a scalar, this will use the same last time for each individual in 
<code>newdataEvent</code>; (ii) a character string, naming a column in 
<code>newdataEvent</code> in which to look for the last time for each individual;
(iii) <code>NULL</code>, in which case the default is to use the time of the latest 
longitudinal observation in <code>newdataLong</code>. If <code>newdataEvent</code> is
<code>NULL</code> then the <code>last_time</code> argument cannot be specified 
directly; instead it will be set equal to the event or censoring time for
each individual in the dataset that was used to estimate the model. 
If standardised survival probabilities are requested (i.e. 
<code>standardise = TRUE</code>) then conditional survival probabilities are
not allowed and therefore the <code>last_time</code> argument is ignored.</p>
</td></tr>
<tr valign="top"><td><code>prob</code></td>
<td>
<p>A scalar between 0 and 1 specifying the width to use for the 
uncertainty interval (sometimes called credible interval) for the predictions. 
For example <code>prob = 0.95</code> (the default) means that the 2.5th and 97.5th  
percentiles will be provided.</p>
</td></tr>
<tr valign="top"><td><code>ids</code></td>
<td>
<p>An optional vector specifying a subset of IDs for whom the 
predictions should be obtained. The default is to predict for all individuals
who were used in estimating the model or, if <code>newdataLong</code> and 
<code>newdataEvent</code> are specified, then all individuals contained in 
the new data.</p>
</td></tr>
<tr valign="top"><td><code>times</code></td>
<td>
<p>A scalar, a character string, or <code>NULL</code>. Specifies the
times at which the estimated survival probabilities should be calculated. 
It can be either: (i) <code>NULL</code>, in which case it will default to the last known 
survival time for each individual, as determined by the <code>last_time</code>
argument; (ii) a scalar, specifying a time to estimate the survival probability
for each of the individuals; or (iii) if <code>newdataEvent</code> is  
provided, it can be the name of a variable in <code>newdataEvent</code> that 
indicates the time at which the survival probabilities should be calculated  
for each individual.</p>
</td></tr>
<tr valign="top"><td><code>standardise</code></td>
<td>
<p>A logical specifying whether the estimated 
subject-specific survival probabilities should be averaged
across all individuals for whom the subject-specific predictions are 
being obtained. This can be used to average over the covariate and random effects
distributions of the individuals used in estimating the model, or the individuals 
included in the <code>newdata</code> arguments. This approach of
averaging across the observed distribution of the covariates is sometimes
referred to as a &quot;standardised&quot; survival curve. If <code>standardise = TRUE</code>, 
then the <code>times</code> argument must be specified and it must be constant across 
individuals, that is, the survival probabilities must be calculated at the 
same time for all individuals.</p>
</td></tr>
<tr valign="top"><td><code>scale</code></td>
<td>
<p>A scalar, specifying how much to multiply the asymptotic 
variance-covariance matrix for the random effects by, which is then
used as the &quot;width&quot; (ie. variance-covariance matrix) of the multivariate
Student-t proposal distribution in the Metropolis-Hastings algorithm. This
is only relevant when <code>newdataEvent</code> is supplied, in which case new
random effects are simulated for the individuals in the new data using 
the Metropolis-Hastings algorithm.</p>
</td></tr>
<tr valign="top"><td><code>draws</code></td>
<td>
<p>An integer indicating the number of MCMC draws to return. If 
<code>newdataLong</code> and <code>newdataEvent</code> are <code>NULL</code> then the default
and maximum number of draws is the size of the posterior sample. If 
<code>newdataLong</code> and <code>newdataEvent</code> are provided, then the default 
is to set the number of draws equal to 200 (or equal to the size of the 
posterior sample if that
is less than 200). This ensures that the Monte Carlo algorithm for drawing 
the new group-specific coefficients doesn't take an excessive amount of time.</p>
</td></tr>
<tr valign="top"><td><code>seed</code></td>
<td>
<p>An optional <code><a href="../../base/html/Random.html">seed</a></code> to use.</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>Currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>A data frame of class <code>survfit.stanjm</code>. The data frame includes 
columns for each of the following: 
(i) the median of the posterior predictions of the estimated survival
probabilities (<code>survpred</code>);
(ii) each of the lower and upper limits of the corresponding uncertainty 
interval for the estimated survival probabilities (<code>ci_lb</code> and 
<code>ci_ub</code>);
(iii) a subject identifier (<code>id_var</code>), unless standardised survival
probabilities were estimated;
(iv) the time that the estimated survival probability is calculated for 
(<code>time_var</code>).
The returned object also includes a number of additional attributes.
</p>


<h3>Note</h3>

<p>Note that if any variables were transformed (e.g. rescaled) in the data 
used to fit the model, then these variables must also be transformed in 
<code>newdataLong</code> and <code>newdataEvent</code>. This only applies if variables  
were transformed before passing the data to one of the modeling functions and  
<em>not</em> if transformations were specified inside the model formula.
</p>


<h3>References</h3>

<p>Rizopoulos, D. (2011). Dynamic predictions and prospective accuracy in 
joint models for longitudinal and time-to-event data. <em>Biometrics</em>
<strong>67</strong>, 819.
</p>


<h3>See Also</h3>

<p><code><a href="plot.survfit.stanjm.html">plot.survfit.stanjm</a></code> for plotting the estimated survival  
probabilities, <code><a href="ps_check.html">ps_check</a></code> for for graphical checks of the estimated 
survival function, and <code><a href="posterior_traj.html">posterior_traj</a></code> for estimating the
marginal or subject-specific longitudinal trajectories, and 
<code><a href="plot.survfit.stanjm.html">plot_stack_jm</a></code> for combining plots of the estimated subject-specific
longitudinal trajectory and survival function.
</p>


<h3>Examples</h3>

<pre>

  # Run example model if not already loaded
  if (!exists("example_jm")) example(example_jm)
  
  # Obtain subject-specific survival probabilities for a few
  # selected individuals in the estimation dataset who were  
  # known to survive up until their censoring time. By default
  # the posterior_survfit function will estimate the conditional
  # survival probabilities, that is, conditional on having survived
  # until the event or censoring time, and then by default will
  # extrapolate the survival predictions forward from there.  
  ps1 &lt;- posterior_survfit(example_jm, ids = c(7,13,15))
  # We can plot the estimated survival probabilities using the
  # associated plot function
  plot(ps1)
  
  # If we wanted to estimate the survival probabilities for the
  # same three individuals as the previous example, but this time
  # we won't condition on them having survived up until their 
  # censoring time. Instead, we will estimate their probability
  # of having survived between 0 and 5 years given their covariates
  # and their estimated random effects.
  # The easiest way to achieve the time scale we want (ie, 0 to 5 years)
  # is to specify that we want the survival time estimated at time 0
  # and then extrapolated forward 5 years. We also specify that we
  # do not want to condition on their last known survival time.
  ps2 &lt;- posterior_survfit(example_jm, ids = c(7,13,15), times = 0,
    extrapolate = TRUE, condition = FALSE, control = list(edist = 5))
    
  # Instead we may want to estimate subject-specific survival probabilities 
  # for a set of new individuals. To demonstrate this, we will simply take
  # the first two individuals in the estimation dataset, but pass their data
  # via the newdata arguments so that posterior_survfit will assume we are 
  # predicting survival for new individuals and draw new random effects 
  # under a Monte Carlo scheme (see Rizopoulos (2011)).
  ndL &lt;- pbcLong[pbcLong$id %in% c(1,2),]
  ndE &lt;- pbcSurv[pbcSurv$id %in% c(1,2),]
  ps3 &lt;- posterior_survfit(example_jm,
    newdataLong = ndL, newdataEvent = ndE,
    last_time = "futimeYears", seed = 12345)
  head(ps3)
  # We can then compare the estimated random effects for these 
  # individuals based on the fitted model and the Monte Carlo scheme
  ranef(example_jm)$Long1$id[1:2,,drop=FALSE] # from fitted model
  colMeans(attr(ps3, "b_new"))                # from Monte Carlo scheme
  
  # Lastly, if we wanted to obtain "standardised" survival probabilities, 
  # (by averaging over the observed distribution of the fixed effect 
  # covariates, as well as averaging over the estimated random effects
  # for individuals in our estimation sample or new data) then we can 
  # specify 'standardise = TRUE'. We can then plot the resulting 
  # standardised survival curve.
  ps4 &lt;- posterior_survfit(example_jm, standardise = TRUE, 
                           times = 0, extrapolate = TRUE)
  plot(ps4)

 
</pre>

<hr /><div style="text-align: center;">[Package <em>rstanarm</em> version 2.17.3 <a href="00Index.html">Index</a>]</div>
</body></html>
