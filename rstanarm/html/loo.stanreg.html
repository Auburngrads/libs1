<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Information criteria and cross-validation</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for loo.stanreg {rstanarm}"><tr><td>loo.stanreg {rstanarm}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Information criteria and cross-validation</h2>

<h3>Description</h3>

<p>For models fit using MCMC, compute approximate leave-one-out cross-validation
(LOO, LOOIC) or, less preferably, the Widely Applicable Information Criterion
(WAIC) using the <span class="pkg"><a href="../../loo/html/loo-package.html">loo</a></span> package. Exact <i>K</i>-fold 
cross-validation is also available. Compare two or more models using the 
<code>compare_models</code> function. <strong>Note:</strong> these functions are not 
guaranteed to work properly unless the <code>data</code> argument was specified 
when the model was fit.
</p>


<h3>Usage</h3>

<pre>
## S3 method for class 'stanreg'
loo(x, ..., k_threshold = NULL)

## S3 method for class 'stanreg'
waic(x, ...)

kfold(x, K = 10, save_fits = FALSE)

compare_models(..., loos = list())
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>
<p>A fitted model object returned by one of the 
<span class="pkg">rstanarm</span> modeling functions. See <code><a href="stanreg-objects.html">stanreg-objects</a></code>.</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>For the <code>loo</code> method, <code>...</code> can be used to pass optional
arguments (e.g. <code>cores</code>) to <code><a href="../../loo/html/psislw.html">psislw</a></code>. For 
<code>compare_models</code>, <code>...</code> should contain two or more objects 
returned by the <code>loo</code>, <code>kfold</code>, or <code>waic</code> method (see the 
<strong>Examples</strong> section, below).</p>
</td></tr>
<tr valign="top"><td><code>k_threshold</code></td>
<td>
<p>Threshold for flagging estimates of the Pareto shape 
parameters <i>k</i> estimated by <code>loo</code>. See the <em>How to proceed
when <code>loo</code> gives warnings</em> section, below, for details.</p>
</td></tr>
<tr valign="top"><td><code>K</code></td>
<td>
<p>For <code>kfold</code>, the number of subsets of equal (if possible) size
into which the data will be randomly partitioned for performing
<i>K</i>-fold cross-validation. The model is refit <code>K</code> times, each time
leaving out one of the <code>K</code> subsets. If <code>K</code> is equal to the total
number of observations in the data then <i>K</i>-fold cross-validation is
equivalent to exact leave-one-out cross-validation.</p>
</td></tr>
<tr valign="top"><td><code>save_fits</code></td>
<td>
<p>If <code>TRUE</code>, a component 'fits' is added to the returned
object to store the cross-validated <a href="stanreg-objects.html">stanreg</a>
objects and the indices of the omitted observations for each fold. Defaults
to <code>FALSE</code>.</p>
</td></tr>
<tr valign="top"><td><code>loos</code></td>
<td>
<p>For <code>compare_models</code>, a list of two or more objects returned
by the <code>loo</code>, <code>kfold</code>, or <code>waic</code> method. This argument can 
be used as an alternative to passing these objects via <code>...</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The <code>loo</code> and <code>waic</code> methods return an object of class
'loo'. See the <strong>Value</strong> section in <code><a href="../../loo/html/loo.html">loo</a></code> and 
<code><a href="../../loo/html/waic.html">waic</a></code> (from the <span class="pkg">loo</span> package) for details on the 
structure of these objects.
</p>
<p><code>kfold</code> returns an object with has classes 'kfold' and 'loo' 
that has a similar structure as the objects returned by the <code>loo</code> and
<code>waic</code> methods.
</p>
<p><code>compare_models</code> returns a vector or matrix with class 
'compare.loo'. See the <strong>Comparing models</strong> section below for more
details.
</p>


<h3>Approximate LOO CV</h3>

<p>The <code>loo</code> method for stanreg objects
provides an interface to the <span class="pkg"><a href="../../loo/html/loo-package.html">loo</a></span> package for
approximate leave-one-out cross-validation (LOO). The LOO Information
Criterion (LOOIC) has the same purpose as the Akaike Information Criterion
(AIC) that is used by frequentists. Both are intended to estimate the
expected log predictive density (ELPD) for a new dataset. However, the AIC
ignores priors and assumes that the posterior distribution is multivariate
normal, whereas the functions from the <span class="pkg">loo</span> package do not make this
distributional assumption and integrate over uncertainty in the parameters.
This only assumes that any one observation can be omitted without having a
major effect on the posterior distribution, which can be judged using the
diagnostic plot provided by the <code><a href="../../loo/html/plot.loo.html">plot.loo</a></code> method and the
warnings provided by the <code><a href="../../loo/html/print.loo.html">print.loo</a></code> method (see the
<em>How to Use the rstanarm Package</em> vignette for an example of this
process).
</p>


<h4>How to proceed when <code>loo</code> gives warnings (k_threshold)</h4>

 
<p>The <code>k_threshold</code> argument to the <code>loo</code> method for <span class="pkg">rstanarm</span>
models is provided as a possible remedy when the diagnostics reveal
problems stemming from the posterior's sensitivity to particular
observations. Warnings about Pareto <i>k</i> estimates indicate observations
for which the approximation to LOO is problematic (this is described in
detail in Vehtari, Gelman, and Gabry (2017) and the
<span class="pkg"><a href="../../loo/html/loo-package.html">loo</a></span> package documentation). The
<code>k_threshold</code> argument can be used to set the <i>k</i> value above
which an observation is flagged. If <code>k_threshold</code> is not <code>NULL</code>
and there are <i>J</i> observations with <i>k</i> estimates above
<code>k_threshold</code> then when <code>loo</code> is called it will refit the 
original model <i>J</i> times, each time leaving out one of the <i>J</i> 
problematic observations. The pointwise contributions of these observations
to the total ELPD are then computed directly and substituted for the
previous estimates from these <i>J</i> observations that are stored in the
object created by <code>loo</code>.
</p>
<p><strong>Note</strong>: in the warning messages issued by <code>loo</code> about large 
Pareto <i>k</i> estimates we recommend setting <code>k_threshold</code> to at
least <i>0.7</i>. There is a theoretical reason, explained in Vehtari,
Gelman, and Gabry (2017), for setting the threshold to the stricter value
of <i>0.5</i>, but in practice they find that errors in the LOO
approximation start to increase non-negligibly when <i>k &gt; 0.7</i>. 
</p>



<h3>K-fold CV</h3>

<p>The <code>kfold</code> function performs exact <i>K</i>-fold
cross-validation. First the data are randomly partitioned into <i>K</i>
subsets of equal (or as close to equal as possible) size. Then the model is
refit <i>K</i> times, each time leaving out one of the <code>K</code> subsets. If
<i>K</i> is equal to the total number of observations in the data then
<i>K</i>-fold cross-validation is equivalent to exact leave-one-out
cross-validation (to which <code>loo</code> is an efficient approximation). The
<code>compare_models</code> function is also compatible with the objects returned
by <code>kfold</code>.
</p>


<h3>Comparing models</h3>

<p><code>compare_models</code> is a wrapper around the
<code><a href="../../loo/html/compare.html">compare</a></code> function in the <span class="pkg">loo</span> package. Before
calling <code>compare</code>, <code>compare_models</code> performs some extra checks to
make sure the <span class="pkg">rstanarm</span> models are suitable for comparison. These
extra checks include verifying that all models to be compared were fit
using the same outcome variable and likelihood family.
</p>
<p>If exactly two models are being compared then <code>compare_models</code> returns
a vector containing the difference in expected log predictive density 
(ELPD) between the models and the standard error of that difference (the 
documentation for <code><a href="../../loo/html/compare.html">compare</a></code> has additional details about 
the calculation of the standard error of the difference). The difference in
ELPD will be negative if the expected out-of-sample predictive accuracy of
the first model is higher. If the difference is be positive then the second
model is preferred.
</p>
<p>If more than two models are being compared then <code>compare_models</code> 
returns a matrix with one row per model. This matrix summarizes the objects
and arranges them in descending order according to expected out-of-sample
predictive accuracy. That is, the first row of the matrix will be 
for the model with the largest ELPD (smallest LOOIC).
</p>


<h3>References</h3>

<p>Vehtari, A., Gelman, A., and Gabry, J. (2017). Practical
Bayesian model evaluation using leave-one-out cross-validation and WAIC.
<em>Statistics and Computing</em>. 27(5), 1413&ndash;1432.
doi:10.1007/s11222-016-9696-4. arXiv preprint:
<a href="http://arxiv.org/abs/1507.04544/">http://arxiv.org/abs/1507.04544/</a>
</p>


<h3>See Also</h3>


<ul>
<li><p> The various <span class="pkg">rstanarm</span> vignettes for more examples of 
using <code>loo</code> and <code>compare_models</code>.
</p>
</li>
<li> <p><code><a href="../../loo/html/loo-package.html">loo-package</a></code> (in particular the <em>PSIS-LOO</em> 
section)  for details on the computations implemented by the <span class="pkg">loo</span> 
package and the interpretation of the Pareto <i>k</i> estimates displayed 
when using the  <code><a href="../../loo/html/pareto-k-diagnostic.html">plot.loo</a></code> method.
</p>
</li>
<li> <p><code><a href="log_lik.stanreg.html">log_lik.stanreg</a></code> to directly access the pointwise 
log-likelihood matrix. 
</p>
</li></ul>



<h3>Examples</h3>

<pre>

fit1 &lt;- stan_glm(mpg ~ wt, data = mtcars)
fit2 &lt;- stan_glm(mpg ~ wt + cyl, data = mtcars)

# compare on LOOIC
(loo1 &lt;- loo(fit1, cores = 2))
loo2 &lt;- loo(fit2, cores = 2)
plot(loo2)

# when comparing exactly two models, the reported 'elpd_diff' will be 
# positive if the expected predictive accuracy for the second model is higher
compare_models(loo1, loo2) # or compare_models(loos = list(loo1, loo2))

# when comparing three or more models they are ordered by expected
# predictive accuracy
fit3 &lt;- stan_glm(mpg ~ ., data = mtcars)
loo3 &lt;- loo(fit3, k_threshold = 0.7, cores = 2)
compare_models(loo1, loo2, loo3)

# 10-fold cross-validation
(kfold1 &lt;- kfold(fit1, K = 10))
kfold2 &lt;- kfold(fit2, K = 10)
compare_models(kfold1, kfold2)


</pre>

<hr /><div style="text-align: center;">[Package <em>rstanarm</em> version 2.17.3 <a href="00Index.html">Index</a>]</div>
</body></html>
